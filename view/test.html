<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
          name="viewport">
    <meta content="ie=edge" http-equiv="X-UA-Compatible">
    <title>Document</title>
    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" rel="stylesheet">
</head>
<body>
<div class="container">
    <button id="prepare">Prepare</button>
    <button id="getWallet">Get Wallet</button>
    <div id="requestKey"></div>
    <div>
        <button id="web2appTestBtn">카카오톡 공유하기 버튼</button>
        <br/><br/><br/><br/>
    </div>
</div>

<script crossorigin="anonymous"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
<script crossorigin="anonymous"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"></script>
<script crossorigin="anonymous"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script type="text/javascript" src="/static/web2app.js"></script>

<script>
    const prepare = document.getElementById("prepare")
    const requestKey = document.getElementById("requestKey")

    prepare.addEventListener("click", () => {
        prepareF()
    })


    function prepareF() {
        const formData = {
            bapp: {
                name: "test",
                callback: {
                    success: "test://",
                    fail: "test://",
                },
            },
            type: "auth",
        }
        $.ajax({
            url: "https://a2a-api.klipwallet.com/v2/a2a/prepare",
            type: "POST",
            data: JSON.stringify(formData),
            dataType: "json",
            contentType: "application/json",
            success: function (data) {
                requestKey.innerText = data.request_key
                console.log(data)
            },
            error: function (error) {
                console.log(error)
            }
        });
    }

    const getWallet = document.getElementById("getWallet")
    getWallet.addEventListener("click", () => {
        getWalletF()
    })

    function getWalletF() {

        console.log(requestKey.innerText)
        $.ajax({
            url: `https://a2a-api.klipwallet.com/v2/a2a/result?request_key=${requestKey.innerText}`,
            type: "GET",
            dataType: "json",
            contentType: "application/json",
            success: function (data) {
                console.log(data)
            },
            error: function (error) {
                console.log(error)
            }
        });
    }

    function checkMobile() {

        var varUA = navigator.userAgent.toLowerCase(); //userAgent 값 얻기

        if (varUA.indexOf('android') > -1) {
            //안드로이드
            return "android";
        } else if (varUA.indexOf("iphone") > -1 || varUA.indexOf("ipad") > -1 || varUA.indexOf("ipod") > -1) {
            //IOS
            return "ios";
        } else {
            //아이폰, 안드로이드 외
            return "other";
        }

    }

    const type = checkMobile()

    var ua = navigator.userAgent;

    var btnEl = document.getElementById('web2appTestBtn'),
        scheme = 'kakaolink',
        pkgName = 'com.kakao.talk',
        urlScheme = 'kakaolink://send?appkey=d44932a7e94186c156d0ceab1e6a1a57&appver=1.0&apiver=3.0&linkver=3.5&objs=%5B%7B"objtype"%3A"label"%2C"text"%3A"%5B%EB%AF%B8%EB%94%94%EC%96%B4%EB%8B%A4%EC%9D%8C%5D%5Cr%5Cn%EA%B0%9C%EC%99%80%20%EA%B3%A0%EC%96%91%EC%9D%B4%20%EC%84%A0%ED%98%B8%EB%8F%84%EC%97%90%20%EB%94%B0%EB%9D%BC%20%EC%82%AC%EB%9E%8C%EC%9D%98%20%EC%84%B1%EA%B2%A9%EB%8F%84%20%EC%95%8C%20%EC%88%98%20%EC%9E%88%EB%8B%A4%3F"%7D%2C%7B"objtype"%3A"link"%2C"text"%3A"http%3A%2F%2Fm.media.daum.net%2Fm%2Fmedia%2Frealtime%2Fnewsview%2F20140528130607055%3Ffoo%3Dbar%26hello%3Dworld"%2C"action"%3A%7B"type"%3A"web"%2C"url"%3A"http%3A%2F%2Fm.media.daum.net%2Fm%2Fmedia%2Frealtime%2Fnewsview%2F20140528130607055%3Ffoo%3Dbar%26hello%3Dworld"%7D%7D%5D',
        intentURI = 'intent://send?appkey=d44932a7e94186c156d0ceab1e6a1a57&appver=1.0&apiver=3.0&linkver=3.5&objs=%5B%7B"objtype"%3A"label"%2C"text"%3A"%5B%EB%AF%B8%EB%94%94%EC%96%B4%EB%8B%A4%EC%9D%8C%5D%5Cr%5Cn%EA%B0%9C%EC%99%80%20%EA%B3%A0%EC%96%91%EC%9D%B4%20%EC%84%A0%ED%98%B8%EB%8F%84%EC%97%90%20%EB%94%B0%EB%9D%BC%20%EC%82%AC%EB%9E%8C%EC%9D%98%20%EC%84%B1%EA%B2%A9%EB%8F%84%20%EC%95%8C%20%EC%88%98%20%EC%9E%88%EB%8B%A4%3F"%7D%2C%7B"objtype"%3A"link"%2C"text"%3A"http%3A%2F%2Fm.media.daum.net%2Fm%2Fmedia%2Frealtime%2Fnewsview%2F20140528130607055%3Ffoo%3Dbar%26hello%3Dworld"%2C"action"%3A%7B"type"%3A"web"%2C"url"%3A"http%3A%2F%2Fm.media.daum.net%2Fm%2Fmedia%2Frealtime%2Fnewsview%2F20140528130607055%3Ffoo%3Dbar%26hello%3Dworld"%7D%7D%5D#Intent;scheme=' + scheme + ';package=' + pkgName + ';end',
        appStoreURL = (type === "android") ? 'market://details?id=' + pkgName : 'itms-apps://itunes.apple.com/app/id362057947';

    btnEl.addEventListener('click', function () {
        daumtools.web2app({
            urlScheme: urlScheme,
            intentURI: intentURI,
            storeURL: appStoreURL,
            appName: '카카오톡',
            onUnsupportedEnvironment: function () {
                console.log('go to web page'); //example
            },
            willInvokeApp: function () {
                console.log('send click log'); //example
            }
        });

    });

</script>
</body>
</html>